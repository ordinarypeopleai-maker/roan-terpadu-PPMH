<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Ro'an Terpadu ‚Äì Profesional</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="theme-color" content="#1b8f3a">

<!-- Tailwind CSS -->
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.3.2/dist/tailwind.min.css" rel="stylesheet">
<!-- jsPDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" defer></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js" defer></script>

<style>
/* Smooth fade for page transition */
.page { display: none; opacity: 0; transition: opacity 0.3s ease-in-out; }
.page.active { display: block; opacity: 1; }
/* Scrollable tables on small devices */
.table-container { overflow-x: auto; }
</style>
</head>
<body class="bg-gray-50 font-sans">

<header class="bg-gradient-to-r from-green-700 to-green-500 text-white p-4 shadow sticky top-0 z-20">
  <h1 class="text-2xl font-bold">Ro'an Terpadu</h1>
  <p class="text-sm">Sistem Penjadwalan Ro'an TPS & Jumat Kubro</p>
</header>

<main class="max-w-5xl mx-auto p-4 space-y-6">

  <!-- HOME -->
  <section id="home" class="page active bg-white rounded-xl shadow p-6 space-y-4">
    <h2 class="text-xl font-semibold">Pilih Layanan</h2>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
      <div class="bg-green-100 p-6 rounded-xl cursor-pointer hover:bg-green-200 hover:scale-105 transition" onclick="showPage('kubro')">
        <h3 class="font-medium text-md">üóìÔ∏è Ro'an Jumat Kubro</h3>
      </div>
      <div class="bg-blue-100 p-6 rounded-xl cursor-pointer hover:bg-blue-200 hover:scale-105 transition" onclick="showPage('tps')">
        <h3 class="font-medium text-md">üìã Ro'an TPS</h3>
      </div>
      <div class="bg-yellow-100 p-6 rounded-xl cursor-pointer hover:bg-yellow-200 hover:scale-105 transition" onclick="showPage('info')">
        <h3 class="font-medium text-md">üì¢ Informasi</h3>
      </div>
    </div>
  </section>

  <!-- KUBRO -->
  <section id="kubro" class="page bg-white rounded-xl shadow p-6">
    <button class="text-green-700 font-medium mb-4" onclick="showPage('home')">‚¨Ö Home</button>
    <h2 class="text-lg font-semibold mb-4">Jadwal Ro'an Jumat Kubro</h2>

    <div class="flex flex-wrap gap-2 mb-4 items-center">
      <select id="bulan" class="border rounded px-2 py-1"></select>
      <select id="tahun" class="border rounded px-2 py-1"></select>
      <button id="btnTampilKUBRO" class="bg-green-700 text-white px-4 py-1 rounded hover:bg-green-800">Tampilkan</button>
      <button id="btnExportKUBRO" class="bg-green-600 text-white px-4 py-1 rounded hover:bg-green-700">Export PDF</button>
    </div>

    <div class="table-container">
      <table class="min-w-full border border-gray-200 table-auto" id="tabelKUBRO">
        <thead class="bg-gray-200 sticky top-0 z-10">
          <tr>
            <th class="p-2">Tanggal</th>
            <th class="p-2">Lokasi</th>
            <th class="p-2">Keterangan</th>
            <th class="p-2">Komplek</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </section>

  <!-- TPS -->
  <section id="tps" class="page bg-white rounded-xl shadow p-6">
    <button class="text-blue-700 font-medium mb-4" onclick="showPage('home')">‚¨Ö Home</button>
    <h2 class="text-lg font-semibold mb-4">Jadwal Ro'an TPS</h2>

    <div class="flex flex-wrap gap-2 mb-4 items-center">
      <select id="bulanTPS" class="border rounded px-2 py-1"></select>
      <select id="tahunTPS" class="border rounded px-2 py-1"></select>
      <input id="cariTPS" placeholder="Cari Komplek" class="border rounded px-2 py-1">
      <button id="btnTampilTPS" class="bg-blue-700 text-white px-4 py-1 rounded hover:bg-blue-800">Tampilkan</button>
      <button id="btnExportTPS" class="bg-blue-600 text-white px-4 py-1 rounded hover:bg-blue-700">Export PDF</button>
    </div>

    <div class="table-container">
      <table class="min-w-full border border-gray-200 table-auto" id="tabelTPS">
        <thead class="bg-gray-200 sticky top-0 z-10">
          <tr>
            <th class="p-2">Tanggal</th>
            <th class="p-2">Hari</th>
            <th class="p-2">Petugas</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </section>

  <!-- INFO -->
  <section id="info" class="page bg-white rounded-xl shadow p-6">
    <button class="text-yellow-700 font-medium mb-4" onclick="showPage('home')">‚¨Ö Home</button>
    <h2 class="text-lg font-semibold mb-4">üì¢ Informasi</h2>
    <textarea id="infoText" class="w-full border rounded p-2 min-h-[120px]"></textarea>
    <div class="mt-2 flex items-center gap-2">
      <button id="btnSimpan" class="bg-yellow-700 text-white px-4 py-1 rounded hover:bg-yellow-800">Simpan</button>
      <span id="statusInfo" class="text-green-600 text-sm"></span>
    </div>
  </section>

</main>

<footer class="text-center text-gray-500 text-sm mt-4 mb-2">¬© 2025‚Äì2029 Ro'an Terpadu</footer>

<script defer>
/* Page switching */
const pages=['home','kubro','tps','info'];
function showPage(p){
  pages.forEach(x=>{
    const el = document.getElementById(x);
    if(x===p){el.classList.add('active');} else {el.classList.remove('active');}
  });
}
window.showPage=showPage;

window.addEventListener('DOMContentLoaded',()=>{

  // ===== KUBRO =====
  const bulanNama=['Januari','Februari','Maret','April','Mei','Juni','Juli','Agustus','September','Oktober','November','Desember'];
  const bulan=document.getElementById('bulan'), tahun=document.getElementById('tahun'), tbody=document.querySelector('#tabelKUBRO tbody');

  bulanNama.forEach((b,i)=>bulan.innerHTML+=`<option value="${i}">${b}</option>`);
  for(let y=2025;y<=2029;y++) tahun.innerHTML+=`<option>${y}</option>`;
  bulan.value=11; tahun.value=2025;

  const komplek=['A','B','C','D','E','F','G','H','I','J'];
  const lokasiNama=["Lokasi 1","Lokasi 2","Lokasi 3","Lokasi 4","Lokasi 5","Lokasi 6","Lokasi 7","Lokasi 8","Lokasi 9","Lokasi 10"];
  const keteranganLokasi=["Masjid Lt 1, 2 dan Depan perpustakaan","Jeding Masjid","Teras Ndalem Gus Minan sampai Halaqoh","Ziarah & Membersihkan Makam Klaseman","Depan Mifda + Komp. C","Madrasah Lt. 1-3, Parkiran Bawah dan Maqom","Jeding Santri dan Depan Laundry","Dapur & Jemuran","Parkiran depan dan samping DU, Teras DU & Jeding Tamu DU","Membuang sampah ke TPS & Mengepel belakang Komp. C"];

  let dataKubro=[], idx=0, d=new Date(2025,11,1);
  while(d<=new Date(2029,11,31)){
    if(d.getDay()==5){
      for(let i=0;i<10;i++){
        dataKubro.push({tgl:d.toLocaleDateString('id-ID'), bulan:d.getMonth(), tahun:d.getFullYear(), lokasi:lokasiNama[i], keterangan:keteranganLokasi[i], komplek:komplek[(idx+i)%10]});
      }
      idx++;
    }
    d.setDate(d.getDate()+1);
  }

  function renderKUBRO(){
    tbody.innerHTML='';
    let last='';
    dataKubro.filter(x=>x.bulan==bulan.value && x.tahun==tahun.value).forEach(x=>{
      if(x.tgl!==last){tbody.innerHTML+=`<tr><td colspan="4" class="bg-gray-200 font-semibold">${x.tgl}</td></tr>`; last=x.tgl;}
      tbody.innerHTML+=`<tr><td></td><td>${x.lokasi}</td><td>${x.keterangan}</td><td>${x.komplek}</td></tr>`;
    });
  }

  function exportPDFKUBRO(){
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF('p','mm','a4');
    doc.setFontSize(14);
    doc.text("JADWAL RO'AN JUMAT KUBRO",105,15,{align:'center'});

    let groups={};
    dataKubro.filter(x=>x.bulan==bulan.value && x.tahun==tahun.value).forEach(x=>{
      if(!groups[x.tgl]) groups[x.tgl]=[];
      groups[x.tgl].push([x.lokasi,x.keterangan,x.komplek]);
    });

    const tglKeys = Object.keys(groups);
    for(let i=0;i<tglKeys.length;i++){
      if(i>0) doc.addPage();
      doc.setFontSize(12);
      doc.text(tglKeys[i],105,22,{align:'center'});
      doc.autoTable({startY:28, head:[["Lokasi","Keterangan","Komplek"]], body:groups[tglKeys[i]], theme:'grid'});
    }

    doc.save('roan_jumat_kubro.pdf');
  }

  document.getElementById('btnTampilKUBRO').addEventListener('click', renderKUBRO);
  document.getElementById('btnExportKUBRO').addEventListener('click', exportPDFKUBRO);

  // ===== TPS =====
  const bulanTPS=document.getElementById('bulanTPS');
  const tahunTPS=document.getElementById('tahunTPS');
  const cariTPS=document.getElementById('cariTPS');
  const tbodyTPS=document.querySelector('#tabelTPS tbody');
  const komplekHarian=["A","B","C","E","F","G","H","I","J"];
  const komplekJumat=["A","B","C","D","E","F","G","H","I","J"];
  let dataTPS=[], dt=new Date(2025,11,1), endTPS=new Date(2029,11,31), di=6, fi=2;
  while(dt<=endTPS){
    const day=dt.getDay();
    let petugas='';
    if(day===0) petugas='Pengurus kebersihan';
    else if(day===5){petugas=komplekJumat[fi%10]; fi++;}
    else{petugas=komplekHarian[di%komplekHarian.length]; di++;}
    dataTPS.push({tgl:dt.toLocaleDateString('id-ID'), hari:dt.toLocaleDateString('id-ID',{weekday:'long'}), petugas, bulan:dt.getMonth(), tahun:dt.getFullYear()});
    dt.setDate(dt.getDate()+1);
  }

  bulanNama.forEach((b,i)=>bulanTPS.innerHTML+=`<option value="${i}">${b}</option>`);
  for(let y=2025;y<=2029;y++)tahunTPS.innerHTML+=`<option>${y}</option>`;
  bulanTPS.value=11; tahunTPS.value=2025;

  function renderTPS(){
    tbodyTPS.innerHTML='';
    const q=cariTPS.value.toUpperCase();
    dataTPS.filter(x=>x.bulan==bulanTPS.value && x.tahun==tahunTPS.value && (q=='' || x.petugas.toUpperCase().includes(q)))
      .forEach(x=>{tbodyTPS.innerHTML+=`<tr><td>${x.tgl}</td><td>${x.hari}</td><td>${x.petugas}</td></tr>`});
  }

  function exportPDFTPS(){
    const { jsPDF }=window.jspdf;
    const doc=new jsPDF('p','mm','a4');
    doc.text("Jadwal Ro'an TPS",105,15,{align:'center'});
    doc.autoTable({startY:22, head:[["Tanggal","Hari","Petugas"]], body:dataTPS.filter(x=>x.bulan==bulanTPS.value && x.tahun==tahunTPS.value).map(d=>[d.tgl,d.hari,d.petugas])});
    doc.save('roan_tps.pdf');
  }

  document.getElementById('btnTampilTPS').addEventListener('click', renderTPS);
  document.getElementById('btnExportTPS').addEventListener('click', exportPDFTPS);

  // ===== INFO =====
  const infoText=document.getElementById('infoText');
  const statusInfo=document.getElementById('statusInfo');
  document.getElementById('btnSimpan').addEventListener('click', ()=>{
    localStorage.setItem('roanInfo', infoText.value);
    statusInfo.textContent='Berhasil disimpan!';
    setTimeout(()=>statusInfo.textContent='',2000);
  });
  if(localStorage.getItem('roanInfo')) infoText.value=localStorage.getItem('roanInfo');

  // initial render
  renderKUBRO();
  renderTPS();
});
</script>

</body>
</html>
