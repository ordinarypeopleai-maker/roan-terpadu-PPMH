<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Ro'an Terpadu ‚Äì Versi Profesional</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="theme-color" content="#1b8f3a">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" defer></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js" defer></script>
<style>
:root{--primary:#1b8f3a;--bg:#f4f6f8}
*{box-sizing:border-box}
body{margin:0;font-family:Segoe UI,Arial,sans-serif;background:var(--bg);font-size:16px;line-height:1.5}
header{background:linear-gradient(135deg,#1b8f3a,#2ecc71);color:#fff;padding:1rem;text-align:center}
header h1{font-size:1.75rem}
header p{font-size:1rem}
main{max-width:1100px;margin:auto;padding:1rem}
.card{background:#fff;border-radius:14px;padding:1rem;box-shadow:0 4px 12px rgba(0,0,0,.08)}
.controls{display:flex;gap:0.5rem;flex-wrap:wrap;margin-bottom:0.75rem}
select,input,button,textarea{padding:0.5rem 0.75rem;border-radius:6px;border:1px solid #ccc;font-size:1rem}
button.primary{background:var(--primary);color:#fff;border:none}
table{width:100%;border-collapse:collapse;font-size:0.9rem;overflow-x:auto;display:block}
th,td{padding:0.5rem;border-bottom:1px solid #eee;text-align:left}
th{background:#f0f2f5}
footer{text-align:center;font-size:0.8rem;color:#777;margin:1rem}

/* MEDIA QUERY UNTUK HP */
@media (max-width: 600px) {
  header h1{font-size:1.5rem}
  header p{font-size:0.9rem}
  h2{font-size:1.1rem}
  h3{font-size:1rem}
  .card{padding:0.75rem}
  .controls select, .controls input, .controls button, textarea{font-size:0.9rem;padding:0.4rem 0.6rem}
  table{font-size:0.8rem}
  footer{font-size:0.75rem}
}
</style>
</head>
<body>
<header>
<h1>Ro'an Terpadu</h1>
<p>Sistem Penjadwalan Ro'an TPS & Jumat Kubro</p>
</header>
<main>
<section id="home" class="card">
<h2>Pilih Layanan</h2>
<div style="display:flex;flex-direction:column;gap:1rem">
  <div class="card" onclick="showPage('kubro')" style="cursor:pointer"><h3>üóìÔ∏è Ro'an Jumat Kubro</h3></div>
  <div class="card" onclick="showPage('tps')" style="cursor:pointer"><h3>üìã Ro'an TPS</h3></div>
  <div class="card" onclick="showPage('info')" style="cursor:pointer"><h3>üì¢ Informasi</h3></div>
</div>
</section>
<section id="kubro" class="card" style="display:none">
<button id="btnHomeKUBRO">‚¨Ö Home</button>
<h2>Jadwal Ro'an Jumat Kubro</h2>
<div class="controls">
<select id="bulan"></select>
<select id="tahun"></select>
<button class="primary" id="btnTampilKUBRO">Tampilkan</button>
<button id="btnExportKUBRO">Export PDF</button>
</div>
<div style="overflow-x:auto">
<table id="tabelKUBRO"><thead><tr><th>Tanggal</th><th>Lokasi</th><th>Keterangan</th><th>Komplek</th></tr></thead><tbody></tbody></table>
</div>
</section>
<section id="tps" class="card" style="display:none">
<button id="btnHomeTPS">‚¨Ö Home</button>
<h2>Jadwal Ro'an TPS</h2>
<div class="controls">
<select id="bulanTPS"></select>
<select id="tahunTPS"></select>
<input id="cariTPS" placeholder="Cari Komplek">
<button class="primary" id="btnTampilTPS">Tampilkan</button>
<button id="btnExportTPS">Export PDF</button>
</div>
<div style="overflow-x:auto">
<table id="tabelTPS"><thead><tr><th>Tanggal</th><th>Hari</th><th>Petugas</th></tr></thead><tbody></tbody></table>
</div>
</section>
<section id="info" class="card" style="display:none">
<button id="btnHomeInfo">‚¨Ö Home</button>
<h2>üì¢ Informasi</h2>
<textarea id="infoText" style="width:100%;min-height:120px"></textarea>
<br><br><button id="btnSimpan" class="primary">Simpan</button>
<p id="statusInfo" style="color:green; font-size:0.9rem; margin-top:0.4rem;"></p>
</section>
</main>
<footer>¬© 2025‚Äì2029 Ro'an Terpadu</footer>
<script defer>
// ShowPage global
const pages=['home','kubro','tps','info'];
function showPage(p){pages.forEach(x=>document.getElementById(x).style.display=x===p?'block':'none')}
window.showPage=showPage;

window.addEventListener('DOMContentLoaded',()=>{
// ===== KUBRO =====
const bulanNama=['Januari','Februari','Maret','April','Mei','Juni','Juli','Agustus','September','Oktober','November','Desember'];
const bulan=document.getElementById('bulan'),tahun=document.getElementById('tahun'),tbody=document.querySelector('#tabelKUBRO tbody');
bulanNama.forEach((b,i)=>bulan.innerHTML+=`<option value="${i}">${b}</option>`);
for(let y=2025;y<=2029;y++)tahun.innerHTML+=`<option>${y}</option>`;
bulan.value=11;tahun.value=2025;

const komplek=['A','B','C','D','E','F','G','H','I','J'];
const lokasiNama=["Lokasi 1","Lokasi 2","Lokasi 3","Lokasi 4","Lokasi 5","Lokasi 6","Lokasi 7","Lokasi 8","Lokasi 9","Lokasi 10"];
const keteranganLokasi=["Masjid Lt 1, 2 dan Depan perpustakaan","Jeding Masjid","Teras Ndalem Gus Minan sampai Halaqoh","Ziarah & Membersihkan Makam Klaseman","Depan Mifda + Komp. C","Madrasah Lt. 1-3, Parkiran Bawah dan Maqom","Jeding Santri dan Depan Laundry","Dapur & Jemuran","Parkiran depan dan samping DU, Teras DU & Jeding Tamu DU","Membuang sampah ke TPS & Mengepel belakang Komp. C"];
let dataKubro=[],idx=0,d=new Date(2025,11,1);
while(d<=new Date(2029,11,31)){
 if(d.getDay()==5){
   for(let i=0;i<10;i++){
     dataKubro.push({tgl:d.toLocaleDateString('id-ID'),bulan:d.getMonth(),tahun:d.getFullYear(),lokasi:lokasiNama[i],keterangan:keteranganLokasi[i],komplek:komplek[(idx+i)%10]});
   }
   idx++
 }
 d.setDate(d.getDate()+1);
}

// Render KUBRO
document.getElementById('btnTampilKUBRO').addEventListener('click',()=>{
 tbody.innerHTML='';
 let last='';
 dataKubro.filter(x=>x.bulan==bulan.value&&x.tahun==tahun.value).forEach(x=>{
   if(x.tgl!==last){tbody.innerHTML+=`<tr><td colspan="4" style="background:#eef">${x.tgl}</td></tr>`;last=x.tgl;}
   tbody.innerHTML+=`<tr><td></td><td>${x.lokasi}</td><td>${x.keterangan}</td><td>${x.komplek}</td></tr>`;
 });
});

// Export PDF KUBRO (multi-Jumat per halaman)
function exportPDFKUBRO(){
 const { jsPDF } = window.jspdf;
 const doc = new jsPDF('p','mm','a4');
 doc.setFontSize(14);
 doc.text("JADWAL RO'AN JUMAT KUBRO",105,15,{align:'center'});
 let groups={};
 dataKubro.filter(x=>x.bulan==bulan.value&&x.tahun==tahun.value).forEach(x=>{
   if(!groups[x.tgl]) groups[x.tgl]=[];
   groups[x.tgl].push([x.lokasi,x.keterangan,x.komplek]);
 });
 const tglKeys = Object.keys(groups);
 tglKeys.forEach((tgl,i)=>{
   if(i>0) doc.addPage();
   doc.setFontSize(12);
   doc.text(tgl,105,22,{align:'center'});
   doc.autoTable({startY:28,head:[["Lokasi","Keterangan","Komplek"]],body:groups[tgl],theme:'grid',styles:{cellWidth:'wrap'}});
 });
 doc.save('roan_jumat_kubro.pdf');
}
document.getElementById('btnExportKUBRO').addEventListener('click',exportPDFKUBRO);

// ===== TPS =====
const bulanTPS=document.getElementById('bulanTPS');
const tahunTPS=document.getElementById('tahunTPS');
const cariTPS=document.getElementById('cariTPS');
const tbodyTPS=document.querySelector('#tabelTPS tbody');
const komplekHarian=["A","B","C","E","F","G","H","I","J"];
const komplekJumat=["A","B","C","D","E","F","G","H","I","J"];
let dataTPS=[];
let dt=new Date(2025,11,1),endTPS=new Date(2029,11,31),di=6,fi=2;
while(dt<=endTPS){
  const day=dt.getDay();
  let petugas='';
  if(day===0) petugas='Pengurus kebersihan';
  else if(day===5){petugas=komplekJumat[fi%10];fi++;}
  else{petugas=komplekHarian[di%komplekHarian.length];di++;}
  dataTPS.push({tgl:dt.toLocaleDateString('id-ID'),hari:dt.toLocaleDateString('id-ID',{weekday:'long'}),petugas,bulan:dt.getMonth(),tahun:dt.getFullYear()});
  dt.setDate(dt.getDate()+1);
}
bulanNama.forEach((b,i)=>bulanTPS.innerHTML+=`<option value="${i}">${b}</option>`);
for(let y=2025;y<=2029;y++)tahunTPS.innerHTML+=`<option>${y}</option>`;
bulanTPS.value=11;tahunTPS.value=2025;

// Render TPS
document.getElementById('btnTampilTPS').addEventListener('click',()=>{
 tbodyTPS.innerHTML='';
 const q=cariTPS.value.toUpperCase();
 let filtered=dataTPS.filter(x=>x.bulan==bulanTPS.value&&x.tahun==tahunTPS.value&&(q==''||x.petugas.toUpperCase().includes(q)));
 filtered.slice(0,50).forEach(x=>{
   tbodyTPS.innerHTML+=`<tr><td>${x.tgl}</td><td>${x.hari}</td><td>${x.petugas}</td></tr>`;
 });
});

// Export PDF TPS
document.getElementById('btnExportTPS').addEventListener('click',()=>{
 const { jsPDF }=window.jspdf;
 const doc=new jsPDF('p','mm','a4');
 doc.text("Jadwal Ro'an TPS",105,15,{align:'center'});
 doc.autoTable({startY:22,head:[["Tanggal","Hari","Petugas"]],body:dataTPS.filter(x=>x.bulan==bulanTPS.value&&x.tahun==tahunTPS.value).map(d=>[d.tgl,d.hari,d.petugas]),theme:'grid'});
 doc.save('roan_tps.pdf');
});

// ===== INFORMASI =====
const infoText=document.getElementById('infoText');
const statusInfo=document.getElementById('statusInfo');
if(localStorage.getItem('roanInfo')) infoText.value=localStorage.getItem('roanInfo');
document.getElementById('btnSimpan').addEventListener('click',()=>{
 localStorage.setItem('roanInfo',infoText.value.trim());
 statusInfo.textContent="Informasi berhasil disimpan ‚úÖ";
 setTimeout(()=>{statusInfo.textContent='';},3000);
});

// Home buttons
document.getElementById('btnHomeKUBRO').addEventListener('click',()=>showPage('home'));
document.getElementById('btnHomeTPS').addEventListener('click',()=>showPage('home'));
document.getElementById('btnHomeInfo').addEventListener('click',()=>showPage('home'));

showPage('home');
});
</script>
</body>
</html>
