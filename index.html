<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Ro'an Terpadu ‚Äì Versi Profesional</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="theme-color" content="#1b8f3a">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" defer></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js" defer></script>
<style>
:root{--primary:#1b8f3a;--bg:#f4f6f8}
*{box-sizing:border-box}
body{margin:0;font-family:Segoe UI,Arial,sans-serif;background:var(--bg)}
header{background:linear-gradient(135deg,#1b8f3a,#2ecc71);color:#fff;padding:16px;text-align:center}
main{max-width:1100px;margin:auto;padding:16px}
.card{background:#fff;border-radius:14px;padding:20px;box-shadow:0 4px 12px rgba(0,0,0,.08)}
.controls{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px}
select,input,button,textarea{padding:8px 12px;border-radius:6px;border:1px solid #ccc}
button.primary{background:var(--primary);color:#fff;border:none}
table{width:100%;border-collapse:collapse}
th,td{padding:10px;border-bottom:1px solid #eee}
th{background:#f0f2f5}
footer{text-align:center;font-size:12px;color:#777;margin:20px}
</style>
</head>
<body>
<header>
<h1>Ro'an Terpadu</h1>
<p>Sistem Penjadwalan Ro'an TPS & Jumat Kubro</p>
</header>
<main>
<section id="home" class="card">
<h2>Pilih Layanan</h2>
<div style="display:flex;flex-direction:column;gap:14px">
  <div class="card" onclick="showPage('kubro')" style="cursor:pointer"><h3>üóìÔ∏è Ro'an Jumat Kubro</h3></div>
  <div class="card" onclick="showPage('tps')" style="cursor:pointer"><h3>üìã Ro'an TPS</h3></div>
  <div class="card" onclick="showPage('info')" style="cursor:pointer"><h3>üì¢ Informasi</h3></div>
</div>
</section>
<section id="kubro" class="card" style="display:none">
<button onclick="showPage('home')">‚¨Ö Home</button>
<h2>Jadwal Ro'an Jumat Kubro</h2>
<div class="controls">
<select id="bulan"></select>
<select id="tahun"></select>
<button class="primary" onclick="renderKUBRO()">Tampilkan</button>
<button onclick="exportPDFKUBRO()">Export PDF</button>
</div>
<table id="tabelKUBRO"><thead><tr><th>Tanggal</th><th>Lokasi</th><th>Keterangan</th><th>Komplek</th></tr></thead><tbody></tbody></table>
</section>
<section id="tps" class="card" style="display:none">
<button onclick="showPage('home')">‚¨Ö Home</button>
<h2>Jadwal Ro'an TPS</h2>
<div class="controls">
<select id="bulanTPS"></select>
<select id="tahunTPS"></select>
<input id="cariTPS" placeholder="Cari Komplek">
<button class="primary" onclick="renderTPS(true)">Tampilkan</button>
<button onclick="exportPDFTPS()">Export PDF</button>
</div>
<table id="tabelTPS"><thead><tr><th>Tanggal</th><th>Hari</th><th>Petugas</th></tr></thead><tbody></tbody></table>
</section>
<section id="info" class="card" style="display:none">
<button onclick="showPage('home')">‚¨Ö Home</button>
<h2>üì¢ Informasi</h2>
<textarea id="infoText" style="width:100%;min-height:120px"></textarea>
<br><br><button class="primary" onclick="simpanInfo()">Simpan</button>
</section>
</main>
<footer>¬© 2025‚Äì2029 Ro'an Terpadu</footer>
<script defer>
window.addEventListener('DOMContentLoaded',()=>{
const pages=['home','kubro','tps','info'];
function showPage(p){pages.forEach(x=>document.getElementById(x).style.display=x===p?'block':'none')}
window.showPage=showPage;

// KUBRO
const bulanNama=['Januari','Februari','Maret','April','Mei','Juni','Juli','Agustus','September','Oktober','November','Desember'];
const bulan=document.getElementById('bulan'),tahun=document.getElementById('tahun'),tbody=document.querySelector('#tabelKUBRO tbody');
bulanNama.forEach((b,i)=>bulan.innerHTML+=`<option value="${i}">${b}</option>`);
for(let y=2025;y<=2029;y++)tahun.innerHTML+=`<option>${y}</option>`;
bulan.value=11;tahun.value=2025;

const komplek=['A','B','C','D','E','F','G','H','I','J'];
const lokasiNama=["Lokasi 1","Lokasi 2","Lokasi 3","Lokasi 4","Lokasi 5","Lokasi 6","Lokasi 7","Lokasi 8","Lokasi 9","Lokasi 10"];
const keteranganLokasi=["Masjid Lt 1, 2 dan Depan perpustakaan","Jeding Masjid","Teras Ndalem Gus Minan sampai Halaqoh","Ziarah & Membersihkan Makam Klaseman","Depan Mifda + Komp. C","Madrasah Lt. 1-3, Parkiran Bawah dan Maqom","Jeding Santri dan Depan Laundry","Dapur & Jemuran","Parkiran depan dan samping DU, Teras DU & Jeding Tamu DU","Membuang sampah ke TPS & Mengepel belakang Komp. C"];
let dataKubro=[],idx=0,d=new Date(2025,11,1);
while(d<=new Date(2029,11,31)){
 if(d.getDay()==5){
   for(let i=3;i<10;i++){
     dataKubro.push({tgl:d.toLocaleDateString('id-ID'),bulan:d.getMonth(),tahun:d.getFullYear(),lokasi:lokasiNama[i],keterangan:keteranganLokasi[i],komplek:komplek[(idx+i)%10]});
   }
   idx++
 }
 d.setDate(d.getDate()+1);
}

window.renderKUBRO=function(){
 tbody.innerHTML='';
 let last='';
 dataKubro.filter(x=>x.bulan==bulan.value&&x.tahun==tahun.value).forEach(x=>{
   if(x.tgl!==last){tbody.innerHTML+=`<tr><td colspan="4" style="background:#eef">${x.tgl}</td></tr>`;last=x.tgl;}
   tbody.innerHTML+=`<tr><td></td><td>${x.lokasi}</td><td>${x.keterangan}</td><td>${x.komplek}</td></tr>`;
 });
}

window.exportPDFKUBRO = function() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF('p','mm','a4');
  doc.setFontSize(14);
  doc.text("JADWAL RO'AN JUMAT KUBRO", 105, 15, {align: 'center'});

  // Kelompokkan data per tanggal
  let groups = {};
  dataKubro.filter(x => x.bulan == bulan.value && x.tahun == tahun.value)
           .forEach(x => {
              if(!groups[x.tgl]) groups[x.tgl] = [];
              groups[x.tgl].push([x.lokasi, x.keterangan, x.komplek]);
           });

  const tglKeys = Object.keys(groups);

  tglKeys.forEach((tgl, i) => {
    if(i > 0) doc.addPage();
    doc.setFontSize(12);
    doc.text(tgl, 105, 22, {align:'center'});

    const res = doc.autoTable({
      startY: 28,
      head: [["Lokasi","Keterangan","Komplek"]],
      body: groups[tgl],
      theme: 'grid',
      styles: {cellWidth: 'wrap'}
    });

    // Jika tabel melebihi halaman, doc.addPage() otomatis dibuat oleh autoTable
    // Tidak perlu menyesuaikan startY untuk halaman berikutnya karena kita mulai tiap Jumat di halaman baru
  });

  doc.save('roan_jumat_kubro.pdf');
}

// TPS
const bulanTPS=document.getElementById('bulanTPS');
const tahunTPS=document.getElementById('tahunTPS');
const cariTPS=document.getElementById('cariTPS');
const tbodyTPS=document.querySelector('#tabelTPS tbody');
const komplekHarian=["A","B","C","E","F","G","H","I","J"];
const komplekJumat=["A","B","C","D","E","F","G","H","I","J"];
let dataTPS=[];
let dt=new Date(2025,11,1),endTPS=new Date(2029,11,31),di=6,fi=2;
while(dt<=endTPS){
  const day=dt.getDay();
  let petugas='';
  if(day===0) petugas='Pengurus kebersihan';
  else if(day===5){petugas=komplekJumat[fi%10];fi++;}
  else{petugas=komplekHarian[di%komplekHarian.length];di++;}
  dataTPS.push({tgl:dt.toLocaleDateString('id-ID'),hari:dt.toLocaleDateString('id-ID',{weekday:'long'}),petugas,bulan:dt.getMonth(),tahun:dt.getFullYear()});
  dt.setDate(dt.getDate()+1);
}
bulanNama.forEach((b,i)=>bulanTPS.innerHTML+=`<option value="${i}">${b}</option>`);
for(let y=2025;y<=2029;y++)tahunTPS.innerHTML+=`<option>${y}</option>`;
bulanTPS.value=11;tahunTPS.value=2025;

window.renderTPS=function(short=false){
 tbodyTPS.innerHTML='';
 const q=cariTPS.value.toUpperCase();
 let filtered=dataTPS.filter(x=>x.bulan==bulanTPS.value&&x.tahun==tahunTPS.value&&(q==''||x.petugas.toUpperCase().includes(q)));
 if(short) filtered=filtered.slice(0,50);
 filtered.forEach(x=>{
   tbodyTPS.innerHTML+=`<tr><td>${x.tgl}</td><td>${x.hari}</td><td>${x.petugas}</td></tr>`;
 });
}

window.exportPDFTPS=function(){
 const { jsPDF }=window.jspdf;
 const doc=new jsPDF('p','mm','a4');
 doc.text("Jadwal Ro'an TPS",105,15,{align:'center'});
 const res=doc.autoTable({startY:22,head:[["Tanggal","Hari","Petugas"]],body:dataTPS.filter(x=>x.bulan==bulanTPS.value&&x.tahun==tahunTPS.value).map(d=>[d.tgl,d.hari,d.petugas])});
 doc.save('roan_tps.pdf');
}

showPage('home');
});
</script>
</body>
</html>
